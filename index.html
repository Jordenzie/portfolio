<!doctype html> 
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jordan A. McKenzie - Portfolio</title>

  <link rel="icon" type="image/png" sizes="32x32" href="images/folder-32.png" />

  <!-- ======================
       Embedded CSS (combined)
       ====================== -->
  <style>
    /* ---------- Fonts ---------- */
    @font-face {
      font-family: "Chicago";
      src: url("../fonts/pixChicago.woff2") format("woff2");
      font-weight: normal;
      font-style: normal;
    }

    /* ---------- Global ---------- */
    * {
      font-family: "Chicago", sans-serif !important;
      color: black;
      font-size: 12px;
      font-weight: normal !important;
      margin: 0;
      padding: 0;
      -webkit-font-smoothing: none;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: geometricPrecision;
    }

    a { text-decoration: none; }

    /* ---------- Base ---------- */
    body {
      background: #ffffff;
      margin: 0;
      overflow: hidden;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      border: 1px solid #000;
      pointer-events: none;
      z-index: 2000;
    }

    /* ---------- Desktop ---------- */
    .desktop {
      position: absolute;
      top: 38px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .icon {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      width: 99px;
      height: 120px;
      text-align: center;
      cursor: pointer;
      position: absolute;
      user-select: none;
      padding: 6px;
      box-sizing: border-box;
    }

    .icon img {
      width: 66px;
      height: 66px;
      object-fit: contain;
      image-rendering: pixelated;
      flex: 0 0 auto;
      margin-top: 2px;
    }

    .icon span {
      font-size: 10px;
      width: 78px;
      margin-top: 6px;
      line-height: 1.2;
      height: 24px;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      word-break: break-word;
      overflow: hidden;
    }

    .icon.selected { opacity: 0.75; }

    /* ---------- Taskbar ---------- */
    .taskbar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 30px;
      display: flex;
      align-items: center;
      padding: 0 22px;
      box-sizing: border-box;
      z-index: 1000;
      background: #dfdfdf;
      border-top: 1px solid #fff;
      border-bottom: 1px solid #000;
      box-shadow: inset 0 1px 0 #fff, inset 0 -1px 0 #6e6e6e;
    }

    .taskbar::after {
      content: "";
      position: absolute;
      left: 0;
      right: 0;
      bottom: -1px;
      height: 1px;
      background: #000;
    }

    .left-group,
    .right-group {
      display: flex;
      align-items: center;
    }

    .right-group { margin-left: auto; }

    /* ---------- Menu Items ---------- */
    .menu-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      min-height: 22px;
      padding: 2px 6px;
      background: transparent;
      border: 0;
      outline: none;
      cursor: pointer;
      font: inherit;
      white-space: nowrap;
      line-height: normal;
    }

    .menu-item img {
      display: block;
      width: 16px;
      height: 16px;
      image-rendering: pixelated;
      flex: 0 0 auto;
    }

    .menu-item:hover {
      border-top: 1px solid #fff;
      border-left: 1px solid #fff;
      border-right: 1px solid #6f6f6f;
      border-bottom: 1px solid #6f6f6f;
      background: linear-gradient(#efefef, #dcdcdc);
      padding: 1px 5px;
    }

    .menu-item:active {
      border-top: 1px solid #6f6f6f;
      border-left: 1px solid #6f6f6f;
      border-right: 1px solid #fff;
      border-bottom: 1px solid #fff;
      background: linear-gradient(#dcdcdc, #efefef);
      padding: 1px 5px;
    }

    .menubar-clock {
      font-size: 10px;
      padding: 2px 6px;
      white-space: nowrap;
    }

    /* ---------- Search ---------- */
    .search-bar {
      display: none;
      position: fixed;
      top: 30px;
      right: 0;
      background: #efefef;
      border: 1px solid #7d7d7d;
      height: 22px;
      align-items: center;
      padding: 0 6px;
      z-index: 1001;
    }

    .search-bar input {
      width: 160px;
      border: none;
      background: transparent;
      outline: none;
    }

    /* ---------- Search Results ---------- */
    .search-results {
      position: absolute;
      top: 22px;
      right: -1px;
      left: -1px;
      display: none;
      background: #efefef;
      border: 1px solid #7d7d7d;
      border-top: 0;
      box-shadow: 1px 1px 0 #6e6e6e, 2px 2px 0 #000;
      z-index: 1002;
    }

    .search-result {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 3px 6px;
      background: transparent;
      border: 0;
      text-align: left;
      cursor: pointer;
    }

    .search-result:hover,
    .search-result.active {
      background: #dcdcdc;
    }

    .search-result-left {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      min-width: 0;
      flex: 1;
    }

    .search-result-icon {
      width: 16px;
      height: 16px;
      image-rendering: pixelated;
      flex: 0 0 auto;
    }

    .search-result-name {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      min-width: 0;
    }

    .search-hit {
      background: transparent;
      text-decoration: none;
    }

    /* Inverse highlight: dim non-matching characters */
    .search-dim {
      opacity: 0.5;
    }

    .search-result-kind {
      font-size: 10px;
      opacity: 0.8;
      flex: 0 0 auto;
      white-space: nowrap;
    }

    /* ---------- Popup ---------- */
    .popup-overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.55);
      z-index: 3001;
    }

    .popup-overlay.show { display: flex; }

    .popup-window {
      width: min(520px, calc(100vw - 40px));
      max-height: calc(100vh - 80px);
      background: #efefef;
      border: 1px solid #000;
      box-shadow: 1px 1px 0 #6e6e6e, 2px 2px 0 #000;
      display: flex;
      flex-direction: column;
      position: fixed;
    }

    .popup-titlebar {
      height: 22px;
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 0 6px;
      background: #dfdfdf;
      border-top: 1px solid #fff;
      border-bottom: 1px solid #000;
      box-shadow: inset 0 1px 0 #fff, inset 0 -1px 0 #6e6e6e;
      cursor: move;
    }

    .popup-title {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-size: 10px;
    }

    .popup-close {
      width: 14px;
      height: 14px;
      background: #dfdfdf;
      border-top: 1px solid #fff;
      border-left: 1px solid #fff;
      border-right: 1px solid #6f6f6f;
      border-bottom: 1px solid #6f6f6f;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      padding: 0;
      flex: 0 0 auto;
    }

    .popup-close::before {
      content: "";
      width: 8px;
      height: 8px;
      background: #000;
      clip-path: polygon(
        0 10%, 10% 0, 50% 40%, 90% 0, 100% 10%, 60% 50%,
        100% 90%, 90% 100%, 50% 60%, 10% 100%, 0 90%, 40% 50%
      );
    }

    .popup-close:active {
      border-top: 1px solid #6f6f6f;
      border-left: 1px solid #6f6f6f;
      border-right: 1px solid #fff;
      border-bottom: 1px solid #fff;
      background: #dcdcdc;
    }

    .popup-body {
      padding: 10px;
      background: #fff;
      overflow: auto;
      flex: 1;
      border-top: 1px solid #6e6e6e;
      box-shadow: inset 0 1px 0 #fff;
    }

    .popup-actions {
      padding: 6px 8px;
      background: #efefef;
      border-top: 1px solid #6e6e6e;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
    }

    .popup-ok {
      padding: 2px 16px;
      background: #dfdfdf;
      border-top: 1px solid #fff;
      border-left: 1px solid #fff;
      border-right: 1px solid #6f6f6f;
      border-bottom: 1px solid #6f6f6f;
    }

    .popup-ok:active {
      border-top: 1px solid #6f6f6f;
      border-left: 1px solid #6f6f6f;
      border-right: 1px solid #fff;
      border-bottom: 1px solid #fff;
      background: #dcdcdc;
    }

    .popup-caption { display: none !important; }

    .popup-text {
      white-space: pre-wrap;
      font-size: 12px;
      line-height: 1.8;
    }

    .popup-text.align-justify-last-left {
      text-align: justify;
      text-align-last: left;
    }

    .popup-text.align-last-left {
      text-align: justify;
      text-align-last: left;
    }

    .popup-text.align-center {
      text-align: center;
      text-align-last: center;
    }

    .popup-text.role-welcome {
      margin-bottom: 18px;
    }

    .popup-text.role-welcome.wave span {
      display: inline-block;
      animation: welcomeWave 1.6s ease-in-out infinite;
      animation-delay: calc(var(--i) * 0.06s);
      will-change: transform;
    }

    @keyframes welcomeWave {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-4px); }
    }

    .popup-text.role-title {
      text-align: center;
      text-align-last: center;
    }

    .popup-media {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 10px 0;
    }

    .popup-media img {
      image-rendering: pixelated;
      max-width: 100%;
      height: auto;
      border: none;
      box-shadow: none;
      background: transparent;
    }

    .popup-media.size-xs img { max-width: 120px; }
    .popup-media.size-sm img { max-width: 180px; }
    .popup-media.size-md img { max-width: 240px; }
    .popup-media.size-lg img { max-width: 320px; }
    .popup-media.size-xl img { max-width: 420px; }

    @media (max-width: 768px) {
      .taskbar {
        top: auto !important;
        bottom: 0 !important;
        border-top: 1px solid #000000;
        border-bottom: 1px solid #ffffff;
        box-shadow:
          inset 0 -1px 0 #ffffff,
          inset 0 1px 0 #6e6e6e;
      }

      .desktop { top: 10px !important; }

      .search-bar {
        top: auto !important;
        bottom: 30px !important;
      }

      /* Hide Find button on mobile */
      #findBtn { display: none !important; }
    }
  </style>
</head>

<body data-page="home">
  <div class="desktop" id="desktop">
    <a href="pages/j-mac.html" class="icon">
      <img src="images/folder-160.png" alt="Folder" />
      <span>J-Mac</span>
    </a>

    <a href="pages/projects.html" class="icon" data-kind="folder">
      <img src="images/folder-160.png" alt="Folder" />
      <span>Projects</span>
    </a>

    <a href="pages/archive.html" class="icon" data-kind="folder">
      <img src="images/folder-160.png" alt="Folder" />
      <span>Archive</span>
    </a>

    <a href="#" class="icon" data-kind="file">
      <img src="images/text-160.png" alt="Text File" />
      <span>notes_03.txt</span>
    </a>

    <!-- Example files -->
    <a href="#" class="icon" data-kind="file"><img src="images/text-160.png" alt="Text" /><span>draft_01.txt</span></a>
    <a href="#" class="icon" data-kind="file"><img src="images/text-160.png" alt="Text" /><span>ideas.md</span></a>
    <a href="#" class="icon" data-kind="file"><img src="images/text-160.png" alt="Text" /><span>resume_v2.txt</span></a>
    <a href="#" class="icon" data-kind="file"><img src="images/text-160.png" alt="Text" /><span>todo.txt</span></a>
    <a href="#" class="icon" data-kind="file"><img src="images/text-160.png" alt="Text" /><span>meeting_notes.txt</span></a>

    <a href="#" class="icon" data-kind="file"><img src="images/image-160.png" alt="Image" /><span>concept.png</span></a>
    <a href="#" class="icon" data-kind="file"><img src="images/image-160.png" alt="Image" /><span>layout.png</span></a>
    <a href="#" class="icon" data-kind="file"><img src="images/image-160.png" alt="Image" /><span>wireframe.jpg</span></a>
    <a href="#" class="icon" data-kind="file"><img src="images/image-160.png" alt="Image" /><span>screenshot.png</span></a>

    <a href="#" class="icon" data-kind="file"><img src="images/text-160.png" alt="Text" /><span>log_2024.txt</span></a>
    <a href="#" class="icon" data-kind="file"><img src="images/text-160.png" alt="Text" /><span>notes_old.txt</span></a>
    <a href="#" class="icon" data-kind="file"><img src="images/text-160.png" alt="Text" /><span>random.txt</span></a>

    <a href="#" class="icon" data-kind="file"><img src="images/image-160.png" alt="Image" /><span>photo_01.jpg</span></a>
    <a href="#" class="icon" data-kind="file"><img src="images/image-160.png" alt="Image" /><span>photo_02.jpg</span></a>
    <a href="#" class="icon" data-kind="file"><img src="images/image-160.png" alt="Image" /><span>photo_03.jpg</span></a>

    <a href="#" class="icon" data-kind="file"><img src="images/text-160.png" alt="Text" /><span>readme.txt</span></a>
    <a href="#" class="icon" data-kind="file"><img src="images/text-160.png" alt="Text" /><span>changelog.txt</span></a>
    <a href="#" class="icon" data-kind="file"><img src="images/text-160.png" alt="Text" /><span>specs.txt</span></a>
    <a href="#" class="icon" data-kind="file"><img src="images/text-160.png" alt="Text" /><span>archive_list.txt</span></a>
  </div>

  <div class="taskbar">
    <div class="left-group">
      <button class="menu-item taskbar-item" id="aboutBtn" type="button" aria-label="About">
        <img src="images/apple folder.png" alt="Apple Folder" class="menubar-folder" />
        <span class="taskbar-label">About</span>
      </button>

      <a class="menu-item taskbar-item" href="mailto:jam@prtf.io">
        <span class="taskbar-label">E-mail</span>
      </a>
    </div>

    <div class="right-group">
      <div class="menubar-clock" id="menubarClock"></div>
      <button class="menu-item taskbar-item" id="findBtn" type="button" aria-label="Find">
        <img src="images/search icon-64.png" alt="Find" class="menubar-search" />
        <span class="taskbar-label">Find</span>
      </button>
    </div>
  </div>

  <div class="search-bar" id="searchBar">
    <input id="searchInput" type="text" placeholder="Find..." autocomplete="off" />
    <div class="search-results" id="searchResults"></div>
  </div>

  <div class="popup-overlay" id="popupOverlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="popup-window" id="popupWindow">
      <div class="popup-titlebar" id="popupTitlebar">
        <button class="popup-close" id="popupClose" type="button" aria-label="Close"></button>
        <div class="popup-title" id="popupTitle">Window</div>
      </div>

      <div class="popup-body" id="popupBody"></div>

      <div class="popup-actions" id="popupActions">
        <div class="popup-caption" id="popupCaption"></div>
        <button class="popup-ok" id="popupOk" type="button">Enter</button>
      </div>
    </div>
  </div>

  <script defer>
    (function () {
      "use strict";

      function $(id) { return document.getElementById(id); }
      function isMobile() { return window.matchMedia && window.matchMedia("(max-width: 768px)").matches; }

      var aboutBtn = $("aboutBtn");
      var findBtn = $("findBtn");
      var searchBarEl = $("searchBar");
      var searchInput = $("searchInput");
      var searchResultsEl = $("searchResults");
      var clockEl = $("menubarClock");

      var popupOverlay = $("popupOverlay");
      var popupWindow = $("popupWindow");
      var popupTitlebar = $("popupTitlebar");
      var popupClose = $("popupClose");
      var popupTitleEl = $("popupTitle");
      var popupBodyEl = $("popupBody");
      var popupCaptionEl = $("popupCaption");
      var popupOkBtn = $("popupOk");

      function renderPopupContent(content) {
        var wrap = document.createElement("div");
        wrap.className = "popup-content";

        (content || []).forEach(function (block, idx) {
          if (!block || !block.type) return;

          if (block.type === "text") {
            var d = document.createElement("div");
            var size = block.size || "md";
            var align = block.align || "left";
            var role = block.role || (idx === 0 ? "title" : "body");

            d.className = "popup-text size-" + size + " align-" + align + " role-" + role;
            d.textContent = block.text || "";
            wrap.appendChild(d);
          }

          if (block.type === "image") {
            var m = document.createElement("div");
            var size2 = block.size || "md";
            m.className = "popup-media size-" + size2;

            var img = document.createElement("img");
            img.src = block.src || "";
            img.alt = block.alt || "";

            if (block.width) img.width = Number(block.width) || img.width;
            if (block.height) img.height = Number(block.height) || img.height;
            if (block.pixelated === false) img.style.imageRendering = "auto";

            m.appendChild(img);
            wrap.appendChild(m);
          }
        });

        return wrap;
      }

      function resetPopupPosition() {
        if (!popupWindow) return;
        popupWindow.style.left = "50%";
        popupWindow.style.top = "50%";
        popupWindow.style.transform = "translate(-50%, -50%)";
      }

      function openPopup(opts) {
        opts = opts || {};
        if (!popupOverlay) return;

        if (!opts.preservePosition) resetPopupPosition();
        if (popupTitleEl) popupTitleEl.textContent = opts.title || "Notice";

        var caption = (opts.caption != null) ? String(opts.caption) : "";
        if (popupCaptionEl) popupCaptionEl.textContent = caption;

        if (popupBodyEl) {
          popupBodyEl.innerHTML = "";
          if (Array.isArray(opts.content)) popupBodyEl.appendChild(renderPopupContent(opts.content));
          else popupBodyEl.textContent = (opts.text != null) ? String(opts.text) : "";
        }

        var hasOk = (opts.okText != null);
        if (popupOkBtn) {
          if (hasOk) {
            popupOkBtn.textContent = String(opts.okText);
            popupOkBtn.style.display = "inline-flex";
          } else {
            popupOkBtn.style.display = "none";
          }
        }
        if (popupWindow) popupWindow.classList.toggle("has-ok", hasOk);

        popupOverlay.classList.add("show");
        popupOverlay.setAttribute("aria-hidden", "false");
      }

      function closePopup() {
        if (!popupOverlay) return;
        popupOverlay.classList.remove("show");
        popupOverlay.setAttribute("aria-hidden", "true");

        try { if (window.__welcomeClockTimer) { clearInterval(window.__welcomeClockTimer); window.__welcomeClockTimer = null; } } catch (e) {}

        resetPopupPosition();
      }

      window.openPopup = openPopup;
      window.closePopup = closePopup;

      function openAboutPopup() {
        openPopup({
          title: "About",
          okText: "Enter",
          content: [
            { type: "text", role: "title", text: "About This Portfolio", size: "lg", align: "center" },
            {
              type: "text",
              role: "body",
              size: "md",
              align: "left",
              text:
                "This site is a portfolio presented as a classic Macintosh desktop." +
                "Click folders to explore projects and work."
            }
          ]
        });
      }

      if (aboutBtn) aboutBtn.addEventListener("click", function (e) { e.preventDefault(); openAboutPopup(); });

      function showSearch() {
        if (!searchBarEl) return;
        // Rebuild local index each time (so it matches the current page)
        try { SEARCH_INDEX = buildLocalIndex(); } catch (e) {}

        searchBarEl.style.display = "flex";
        if (searchInput) searchInput.focus();
      }
      function hideSearch() {
        if (!searchBarEl) return;
        searchBarEl.style.display = "none";
        if (searchResultsEl) searchResultsEl.style.display = "none";
        if (searchResultsEl) searchResultsEl.innerHTML = "";
      }
      function toggleSearch() {
        if (!searchBarEl) return;
        if (searchBarEl.style.display === "flex") hideSearch();
        else showSearch();
      }

      if (findBtn) findBtn.addEventListener("click", function (e) { e.preventDefault(); toggleSearch(); });
      if (searchInput) searchInput.addEventListener("blur", function () { hideSearch(); });

      if (popupClose) popupClose.addEventListener("click", function (e) { e.stopPropagation(); closePopup(); });
      if (popupOkBtn) popupOkBtn.addEventListener("click", function (e) { e.stopPropagation(); closePopup(); });

      if (popupOverlay) {
        popupOverlay.addEventListener("mousedown", function (e) {
          if (e.target === popupOverlay) closePopup();
        });
      }

      (function bindPopupDrag() {
        if (!popupTitlebar || !popupWindow) return;

        var dragging = false;
        var offX = 0;
        var offY = 0;

        popupTitlebar.addEventListener("mousedown", function (e) {
          if (e.target && e.target.closest && e.target.closest("#popupClose")) return;
          e.preventDefault();

          var r = popupWindow.getBoundingClientRect();
          popupWindow.style.left = r.left + "px";
          popupWindow.style.top = r.top + "px";
          popupWindow.style.transform = "none";

          dragging = true;
          offX = e.clientX - r.left;
          offY = e.clientY - r.top;
        });

        document.addEventListener("mousemove", function (e) {
          if (!dragging) return;

          var r = popupWindow.getBoundingClientRect();
          var x = e.clientX - offX;
          var y = e.clientY - offY;

          var margin = 10;
          var maxX = window.innerWidth - r.width - margin;
          var maxY = window.innerHeight - r.height - margin;

          x = Math.max(margin, Math.min(maxX, x));
          y = Math.max(margin, Math.min(maxY, y));

          popupWindow.style.left = x + "px";
          popupWindow.style.top = y + "px";
        });

        document.addEventListener("mouseup", function () { dragging = false; });

        window.addEventListener("resize", function () {
          if (!popupWindow) return;
          if (popupWindow.style.transform && popupWindow.style.transform !== "none") return;

          var r = popupWindow.getBoundingClientRect();
          var margin = 10;
          var x = Math.max(margin, Math.min(window.innerWidth - r.width - margin, r.left));
          var y = Math.max(margin, Math.min(window.innerHeight - r.height - margin, r.top));
          popupWindow.style.left = x + "px";
          popupWindow.style.top = y + "px";
        });
      })();

      // =====================
      // Find / Search Index (Spotlight-ish)
      // =====================
      function safeText(s) {
        return String(s || "");
      }
      function escHtml(s) {
        return safeText(s)
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/\"/g, "&quot;")
          .replace(/'/g, "&#39;");
      }

      function buildLocalIndex() {
        var items = [];
        document.querySelectorAll(".icon").forEach(function (el) {
          var name = ((el.querySelector("span") && el.querySelector("span").textContent) || "").trim();
          var href = el.getAttribute("href") || "";
          var kind = el.getAttribute("data-kind") || "folder";
          var imgEl = el.querySelector("img");
          var iconSrc = (imgEl && (imgEl.getAttribute("src") || imgEl.src)) || "";
          if (!name) return;
          items.push({ name: name, kind: kind, href: href, icon: iconSrc, el: el });
        });
        return items;
      }

      var SEARCH_INDEX = buildLocalIndex();
      var GLOBAL_INDEX = [];
      var activeIdx = -1;
      var currentMatches = [];
      var RECENTS_KEY = "prtf_find_recents_v1";

      function normalizeItem(it) {
        if (!it) return null;
        var out = {
          name: safeText(it.name).trim(),
          kind: safeText(it.kind || "").trim() || "file",
          href: safeText(it.href || "").trim(),
          icon: safeText(it.icon || "").trim()
        };
        if (!out.name) return null;
        if (!out.kind) out.kind = "file";
        return out;
      }

      function loadGlobalIndex() {
        // Optional: create a search-index.json at site root.
        // Format: [{"name":"J-Mac","kind":"folder","href":"pages/j-mac.html","icon":"images/folder-160.png"}, ...]
        try {
          if (!window.fetch) return;
          fetch("search-index.json", { cache: "no-store" })
            .then(function (r) { return r.ok ? r.json() : null; })
            .then(function (data) {
              if (!Array.isArray(data)) return;
              GLOBAL_INDEX = data.map(normalizeItem).filter(Boolean);
            })
            .catch(function () {});
        } catch (e) {}
      }
      loadGlobalIndex();

      function getCombinedIndex() {
        // Local (current desktop/page) first, then global.
        var seen = Object.create(null);
        var out = [];

        function add(it) {
          var key = (it.kind + "|" + it.href + "|" + it.name).toLowerCase();
          if (seen[key]) return;
          seen[key] = 1;
          out.push(it);
        }

        SEARCH_INDEX.forEach(function (it) { add(it); });
        GLOBAL_INDEX.forEach(function (it) { add(it); });
        return out;
      }

      function fuzzyMatch(name, q) {
        // Returns {score, idxs} or null.
        name = safeText(name);
        q = safeText(q);
        var n = name.toLowerCase();
        var qq = q.toLowerCase();
        if (!qq) return null;

        // Exact substring bonus
        var pos = n.indexOf(qq);
        if (pos !== -1) {
          var idxs = [];
          for (var i = 0; i < qq.length; i++) idxs.push(pos + i);
          // lower score = better
          var score = 0 + pos * 2 + (name.length * 0.05);
          // prefix gets extra boost
          if (pos === 0) score -= 5;
          // word boundary gets boost
          if (pos > 0 && /[^a-z0-9]/i.test(name[pos - 1])) score -= 2;
          return { score: score, idxs: idxs };
        }

        // Fuzzy: letters in order
        var idxs2 = [];
        var last = -1;
        var gaps = 0;
        for (var j = 0; j < qq.length; j++) {
          var ch = qq[j];
          var found = n.indexOf(ch, last + 1);
          if (found === -1) return null;
          if (last !== -1) gaps += Math.max(0, found - last - 1);
          idxs2.push(found);
          last = found;
        }

        // score: prefer early + tight + shorter
        var start = idxs2[0];
        var span = idxs2[idxs2.length - 1] - idxs2[0];
        var score2 = 20 + start * 1.5 + gaps * 1.2 + span * 0.2 + (name.length * 0.08);

        // bonus if first char matches word boundary
        if (start === 0) score2 -= 4;
        else if (start > 0 && /[^a-z0-9]/i.test(name[start - 1])) score2 -= 2;

        return { score: score2, idxs: idxs2 };
      }

      function highlightName(name, idxs) {
        name = safeText(name);
        if (!idxs || !idxs.length) return escHtml(name);

        var set = Object.create(null);
        idxs.forEach(function (i) { set[i] = 1; });

        // Inverse highlight: matched chars stay normal, non-matched chars are dimmed.
        var out = "";
        for (var i = 0; i < name.length; i++) {
          var ch = escHtml(name[i]);
          if (set[i]) out += ch;
          else out += '<span class="search-dim">' + ch + "</span>";
        }
        return out;
      }

      function getRecents() {
        try {
          var raw = localStorage.getItem(RECENTS_KEY);
          var arr = raw ? JSON.parse(raw) : [];
          if (!Array.isArray(arr)) return [];
          return arr.map(normalizeItem).filter(Boolean).slice(0, 8);
        } catch (e) {
          return [];
        }
      }

      function isRecentItem(it) {
        try {
          var key = ((it.kind || "") + "|" + (it.href || "") + "|" + (it.name || "")).toLowerCase();
          var rec = getRecents();
          for (var i = 0; i < rec.length; i++) {
            var r = rec[i];
            var rkey = ((r.kind || "") + "|" + (r.href || "") + "|" + (r.name || "")).toLowerCase();
            if (rkey === key) return true;
          }
        } catch (e) {}
        return false;
      }

      function pushRecent(it) {
        try {
          var rec = getRecents();
          var key = (it.kind + "|" + it.href + "|" + it.name).toLowerCase();
          rec = rec.filter(function (r) {
            return ((r.kind + "|" + r.href + "|" + r.name).toLowerCase() !== key);
          });
          rec.unshift(normalizeItem(it));
          rec = rec.filter(Boolean).slice(0, 8);
          localStorage.setItem(RECENTS_KEY, JSON.stringify(rec));
        } catch (e) {}
      }

      function setActiveRow(i) {
        activeIdx = i;
        if (!searchResultsEl) return;
        Array.prototype.slice.call(searchResultsEl.children).forEach(function (el, idx) {
          el.classList.toggle("active", idx === activeIdx);
        });
      }

      function activateItem(it) {
        hideSearch();
        if (!it) return;

        pushRecent(it);

        if (it.kind === "folder") {
          if (it.href) window.location.href = it.href;
          return;
        }

        if (typeof it.open === "function") {
          it.open();
          return;
        }
        if (it.href) {
          window.location.href = it.href;
          return;
        }
        if (it.el) it.el.dispatchEvent(new MouseEvent("dblclick", { bubbles: true }));
      }

      function renderResults(list, q, opts) {
        opts = opts || {};
        currentMatches = (list || []).slice(0);
        activeIdx = -1;

        if (!searchResultsEl) return;
        searchResultsEl.innerHTML = "";

        if (!currentMatches.length) {
          searchResultsEl.style.display = "none";
          return;
        }

        currentMatches.forEach(function (rowData, idx) {
          var it = rowData.item || rowData;
          var idxs = rowData.idxs || [];

          var row = document.createElement("button");
          row.type = "button";
          row.className = "search-result";
          row.setAttribute("data-idx", String(idx));

          var leftWrap = document.createElement("span");
          leftWrap.className = "search-result-left";

          var icon = document.createElement("img");
          icon.className = "search-result-icon";
          icon.alt = "";
          if (it.icon) icon.src = it.icon;

          var nameEl = document.createElement("span");
          nameEl.className = "search-result-name";
          // highlight
          nameEl.innerHTML = highlightName(it.name, idxs);

          leftWrap.appendChild(icon);
          leftWrap.appendChild(nameEl);

          var right = document.createElement("span");
          right.className = "search-result-kind";
          right.textContent = (opts && opts.isRecentsView)
            ? "Recent"
            : ((it.kind === "folder") ? "Folder" : "File");

          row.appendChild(leftWrap);
          row.appendChild(right);

          row.addEventListener("mousedown", function (e) {
            e.preventDefault();
            activateItem(it);
          });

          searchResultsEl.appendChild(row);
        });

        searchResultsEl.style.display = "block";

        // Spotlight behavior: default to top result
        if (opts.defaultSelectTop && currentMatches.length) {
          setActiveRow(0);
        }
      }

      function matchItems(q) {
        var combined = getCombinedIndex();
        q = safeText(q).trim();
        if (!q) return [];

        var scored = [];
        combined.forEach(function (it) {
          var m = fuzzyMatch(it.name, q);
          if (!m) return;
          scored.push({ item: it, score: m.score, idxs: m.idxs });
        });

        // Better ranking: folders can come first when score ties
        scored.sort(function (a, b) {
          if (a.score !== b.score) return a.score - b.score;
          if (a.item.kind !== b.item.kind) return (a.item.kind === "folder") ? -1 : 1;
          return (a.item.name || "").length - (b.item.name || "").length;
        });

        return scored.slice(0, 8);
      }

      function showRecentsIfEmpty() {
        var rec = getRecents();
        if (!rec.length) {
          if (searchResultsEl) searchResultsEl.style.display = "none";
          return;
        }
        // Render as rows without scoring
        var rows = rec.map(function (it) { return { item: it, score: 999, idxs: [] }; });
        renderResults(rows, "", { defaultSelectTop: true, isRecentsView: true });
      }

      // Keyboard shortcut: Cmd/Ctrl+F or Cmd/Ctrl+K opens Find
      document.addEventListener("keydown", function (e) {
        var key = (e.key || "").toLowerCase();
        var combo = (e.metaKey || e.ctrlKey) && (key === "f" || key === "k");
        if (!combo) return;
        e.preventDefault();
        toggleSearch();
      });

      if (searchInput) {
        searchInput.addEventListener("input", function () {
          var q = searchInput.value || "";
          if (!q.trim()) {
            showRecentsIfEmpty();
            return;
          }
          renderResults(matchItems(q), q, { defaultSelectTop: true });
        });

        searchInput.addEventListener("keydown", function (e) {
          if (!searchResultsEl || searchResultsEl.style.display !== "block") return;

          if (e.key === "ArrowDown") {
            e.preventDefault();
            setActiveRow(Math.min(currentMatches.length - 1, activeIdx + 1));
          } else if (e.key === "ArrowUp") {
            e.preventDefault();
            setActiveRow(Math.max(0, activeIdx - 1));
          } else if (e.key === "Enter") {
            e.preventDefault();
            // Spotlight behavior: enter opens active, else top
            var pick = null;
            if (activeIdx >= 0 && currentMatches[activeIdx]) pick = currentMatches[activeIdx].item || currentMatches[activeIdx];
            else if (currentMatches[0]) pick = currentMatches[0].item || currentMatches[0];
            activateItem(pick);
          } else if (e.key === "Escape") {
            e.preventDefault();
            hideSearch();
          }
        });
      }

      // When Find opens, show recents immediately
      // (SEARCH_INDEX is rebuilt in showSearch())
      var __oldShowSearch = showSearch;
      showSearch = function () {
        __oldShowSearch();
        if (searchInput) {
          if (!(searchInput.value || "").trim()) showRecentsIfEmpty();
        }
      };

      (function initClock() {
        if (!clockEl) return;

        function tick() {
          var now = new Date();
          var h = now.getHours();
          var m = now.getMinutes();
          var ampm = h >= 12 ? "PM" : "AM";
          h = h % 12;
          if (h === 0) h = 12;
          var mm = (m < 10 ? "0" + m : "" + m);
          var colon = (now.getSeconds() % 2 === 0) ? ":" : " ";
          clockEl.textContent = "" + h + colon + mm + " " + ampm;
        }

        tick();
        setInterval(tick, 1000);
      })();

      var icons = Array.prototype.slice.call(document.querySelectorAll(".icon"));

      function layoutIcons() {
        if (!icons.length) return;

        var gapX = 12;
        var gapY = 30;
        var iconW = 99;
        var iconH = 120;

        var margin = 10;
        var available = Math.max(1, window.innerWidth - margin * 2);
        var cols = Math.max(1, Math.floor((available + gapX) / (iconW + gapX)));

        // Center the grid on mobile (and generally keep it nicely centered if roomy)
        var gridW = cols * iconW + (cols - 1) * gapX;

        // Center only on mobile (<=768px)
        var paddingLeft = isMobile()
          ? Math.max(margin, Math.round((window.innerWidth - gridW) / 2))
          : margin;

        var paddingTop = 10;

        var x = paddingLeft;
        var y = paddingTop;
        var col = 0;

        icons.forEach(function (icon) {
          icon.style.left = x + "px";
          icon.style.top = y + "px";

          col++;
          if (col >= cols) {
            col = 0;
            x = paddingLeft;
            y += iconH + gapY;
          } else {
            x += iconW + gapX;
          }
        });
      }

      function clearSelections() { icons.forEach(function (i) { i.classList.remove("selected"); }); }

      var draggingIcon = false;
      var possibleDrag = false;
      var startX = 0, startY = 0;
      var offX2 = 0, offY2 = 0;
      var activeIcon = null;
      var threshold = 5;

      icons.forEach(function (icon) {
        icon.addEventListener("mousedown", function (e) {
          e.preventDefault();

          startX = e.clientX;
          startY = e.clientY;
          activeIcon = icon;
          offX2 = e.clientX - icon.offsetLeft;
          offY2 = e.clientY - icon.offsetTop;

          possibleDrag = true;
          draggingIcon = false;

          clearSelections();
          icon.classList.add("selected");
        });

        icon.addEventListener("click", function (e) {
          e.preventDefault();
          clearSelections();
          icon.classList.add("selected");
        });

        icon.addEventListener("dblclick", function (e) {
          e.preventDefault();

          var href = icon.getAttribute("href");
          var kind = icon.getAttribute("data-kind") || "folder";
          var imgEl = icon.querySelector("img");

          // Image preview
          if (kind === "file" && imgEl && imgEl.src && /\.(png|jpg|jpeg|gif|webp)$/i.test(imgEl.src)) {
            openPopup({
              title: icon.querySelector("span") ? icon.querySelector("span").textContent : "Image",
              okText: "Close",
              content: [
                { type: "image", src: imgEl.src, alt: "Preview", size: "xl" }
              ]
            });
            return;
          }

          if (href && href !== "#") window.location.href = href;
        });
      });

      document.addEventListener("mousemove", function (e) {
        if (!possibleDrag || !activeIcon) return;

        if (!draggingIcon) {
          var dx = e.clientX - startX;
          var dy = e.clientY - startY;
          if (Math.abs(dx) > threshold || Math.abs(dy) > threshold) {
            draggingIcon = true;
            activeIcon.style.zIndex = 1000;
          }
        }

        if (draggingIcon) {
          var x = e.clientX - offX2;
          var y = e.clientY - offY2;
          x = Math.max(0, Math.min(window.innerWidth - activeIcon.offsetWidth, x));
          y = Math.max(0, Math.min(window.innerHeight - activeIcon.offsetHeight, y));
          activeIcon.style.left = x + "px";
          activeIcon.style.top = y + "px";
        }
      });

      document.addEventListener("mouseup", function () {
        possibleDrag = false;
        draggingIcon = false;
        if (activeIcon) activeIcon.style.zIndex = "";
        activeIcon = null;
      });

      document.addEventListener("click", function (e) {
        if (!e.target.closest(".icon")) clearSelections();
      });

      window.addEventListener("resize", function () {
        if (!draggingIcon) layoutIcons();
      });

      layoutIcons();
      window.addEventListener("load", function () {
        layoutIcons();
        requestAnimationFrame(layoutIcons);
      });

      (function maybeWelcome() {
        var page = document.body ? document.body.getAttribute("data-page") : "";
        if (page !== "home") return;

        try {
          if (sessionStorage.getItem("welcomeShown") === "1") return;
          sessionStorage.setItem("welcomeShown", "1");
        } catch (e) {}

        openPopup({
          title: "Loading...",
          okText: "Enter",
          content: [
            { type: "text", role: "title", text: "", size: "xl", align: "center" },
            { type: "image", src: "images/earth.gif", alt: "Welcome", size: "lg" },
            { type: "text", role: "welcome", size: "md", align: "center", text: "Welcome to my portfolio!" },
            { type: "text", role: "body", size: "md", align: "justify-last-left", text: "Here you can find a collection of my work, personal projects, and ideas-in-progress. Feel free to take a look around and see what Iâ€™ve been building. I hope you enjoy your time spent while you're here." }
          ]
        });

        try {
          var welcomeLine = popupBodyEl ? popupBodyEl.querySelector(".popup-text.role-welcome") : null;
          if (welcomeLine && !welcomeLine.classList.contains("wave")) {
            var raw = welcomeLine.textContent || "";
            var html = "";
            for (var i = 0; i < raw.length; i++) {
              var ch = raw[i];
              if (ch === " ") {
                html += "&nbsp;";
              } else {
                if (ch === "&") ch = "&amp;";
                else if (ch === "<") ch = "&lt;";
                else if (ch === ">") ch = "&gt;";
                html += '<span style="--i:' + i + '">' + ch + "</span>";
              }
            }
            welcomeLine.innerHTML = html;
            welcomeLine.classList.add("wave");
          }
        } catch (e) {}

        try { if (window.__welcomeClockTimer) clearInterval(window.__welcomeClockTimer); } catch (e) {}

        var welcomeTitleEl = popupBodyEl ? popupBodyEl.querySelector(".popup-text.role-title") : null;
        function tickWelcomeTitle() {
          if (!welcomeTitleEl) return;
          var d = new Date();
          var dateStr = d.toLocaleDateString(undefined, { weekday: "long", month: "long", day: "numeric" });

          var h = d.getHours();
          var m = d.getMinutes();
          var ampm = h >= 12 ? "PM" : "AM";
          h = h % 12;
          if (h === 0) h = 12;
          var mm = (m < 10 ? "0" + m : "" + m);
          var colon = (d.getSeconds() % 2 === 0) ? ":" : " ";

          welcomeTitleEl.textContent = dateStr + "" + h + colon + mm + " " + ampm;

        }
        tickWelcomeTitle();
        window.__welcomeClockTimer = setInterval(tickWelcomeTitle, 1000);
      })();
    })();
  </script>
</body>
</html>
