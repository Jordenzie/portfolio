<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jordan A. McKenzie - Portfolio</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" type="image/png" sizes="32x32" href="images/folder-32.png" />
  <style>
    @font-face {
      font-family: 'Chicago';
      src: url('fonts/pixChicago.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }

    * {
      font-family: 'Chicago', sans-serif !important;
      color: black;
      font-size: 12px;
      font-weight: normal !important; /* avoid fallback from bold */
      margin: 0;
      padding: 0;
      -webkit-font-smoothing: none;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: geometricPrecision;
    }

    /* Form controls often ignore/reset font unless forced */
    input, textarea, button, select {
      font-family: inherit !important;
      font-size: inherit;
      font-weight: inherit;
    }

    input::placeholder {
      font-family: inherit !important;
      font-weight: inherit;
    }

    body {
      background: #ffffff;
      margin: 0;
      overflow: hidden;
    }

    /* Full-screen Mac-style 1px border on all sides */
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border: 1px solid #000000;
      pointer-events: none;
      z-index: 2000;
    }

    .desktop {
      position: absolute;
      top: 38px; /* adjusted for top taskbar */
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .icon {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      width: 99px;              /* folder width (66px * 1.5) */
      text-align: center;
      cursor: pointer;
      position: absolute;
      user-select: none;
      padding: 6px;
      transition: opacity 0.2s;
    }

    .icon img {
      width: 66px;              /* +50% from previous 44px */
      height: auto;
    }

    .icon span {
      font-size: 7px;
      width: 66px;              /* exactly match folder image width */
      max-width: 66px;
      word-wrap: break-word;
      text-align: center;
    }

    .icon.selected {
      opacity: 0.75;
    }

    /* Fallback positions (so icons never stack even if JS fails) */
    .desktop .icon:nth-of-type(1) { left: 10px; top: 10px; }
    .desktop .icon:nth-of-type(2) { left: 121px; top: 10px; }
    .desktop .icon:nth-of-type(3) { left: 232px; top: 10px; }
    .desktop .icon:nth-of-type(4) { left: 343px; top: 10px; }
    .desktop .icon:nth-of-type(5) { left: 454px; top: 10px; }


    .taskbar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 30px;
      display: flex;
      align-items: center;
      padding: 0 22px;
      box-sizing: border-box;
      z-index: 1000;
      font-size: 12px;

      /* Mac OS 9 "platinum" */
      background: #dfdfdf;
      border-top: 1px solid #ffffff;
      border-bottom: 1px solid #000000;
      box-shadow:
        inset 0 1px 0 #ffffff,
        inset 0 -1px 0 #6e6e6e;
    }

    /* Mobile: move taskbar to bottom */
    @media (max-width: 768px) {
      .taskbar {
        top: auto !important;
        bottom: 0 !important;
        border-top: 1px solid #000000;
        border-bottom: 1px solid #ffffff;
        box-shadow:
          inset 0 -1px 0 #ffffff,
          inset 0 1px 0 #6e6e6e;
      }

      /* move desktop area up so it doesn't hide behind taskbar */
      .desktop {
        top: 10px !important;
      }

      /* on mobile, the Find input should pop up above the bottom taskbar */
      .search-bar {
        top: auto !important;
        bottom: 34px !important; /* 30px taskbar height + a little breathing room */
        right: 6px;
      }
    }

    /* darker separator just under the bar */
    .taskbar::after {
      content: "";
      position: absolute;
      left: 0;
      right: 0;
      bottom: -1px;
      height: 1px;
      background: #000000;
      pointer-events: none;
    }

    .left-group {
      display: flex;
      align-items: center;
      gap: 8px; /* space between items */
      min-width: 0;
      flex: 0 1 auto;
    }

    .menubar-folder {
      width: 16px;
      height: 16px;
      image-rendering: pixelated;
      display: inline-block;
    }

    .menu-item {
      display: inline-flex;
      align-items: center;
      min-height: 22px;        /* allow pixel font full height */
      padding: 2px 6px;        /* real vertical padding instead of tight box */
      box-sizing: border-box;
      text-decoration: none;
      color: #000;
      background: transparent;
      user-select: none;

      /* let font define its own height */
      line-height: normal;

      border: 0;
      cursor: pointer;
      font: inherit;

      white-space: nowrap;
      max-width: 100%;
      min-width: 0;
    }

    /* Taskbar items all share ONE knob set */
    .taskbar-item {
      gap: 4px;
      flex: 0 1 auto; /* allow shrinking instead of overlapping */
      min-width: 0;
    }

    .taskbar-label {
      font-size: 12px;
      line-height: normal;   /* prevent glyph clipping */
      user-select: none;
      display: inline-block;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .menubar-search {
      width: 16px;
      height: 16px;
      image-rendering: pixelated;
      display: inline-block;
    }

    /* Menu item bevel hover (classic platinum, no blue highlight) */
    .menu-item:hover {
      border-top: 1px solid #ffffff;
      border-left: 1px solid #ffffff;
      border-right: 1px solid #6f6f6f;
      border-bottom: 1px solid #6f6f6f;
      background: linear-gradient(#efefef, #dcdcdc);
      color: #000;
    }

    .menu-item:active {
      border-top: 1px solid #6f6f6f;
      border-left: 1px solid #6f6f6f;
      border-right: 1px solid #ffffff;
      border-bottom: 1px solid #ffffff;
      background: linear-gradient(#dcdcdc, #efefef);
      color: #000;
    }

    .search-bar {
      display: none;
      position: fixed;
      top: 23px; /* drop just below the menu bar */
      right: 6px; /* upper-right corner */
      background: #efefef;
      border: 1px solid #7d7d7d;
      box-shadow: inset 0 1px 0 #ffffff;
      height: 22px;
      align-items: center;
      padding: 0 6px;
      z-index: 1001;
    }

    .search-bar input {
      width: 160px;
      background: transparent;
      border: none;
      outline: none;
      padding: 2px 0;
      height: 100%;
      box-sizing: border-box;
    }

    /* Right side cluster (time + find) pinned to the top-right */
    .right-group {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 12px;
      padding-right: 0; /* rely on taskbar padding instead */
      overflow: hidden;
      flex: 1 1 auto;
      justify-content: flex-end;
      min-width: 0;
    }

    .menubar-clock {
      font-family: 'Chicago', sans-serif !important;
      font-weight: normal;
      font-size: 10px;
      line-height: normal;   /* avoid clipping pixel font */
      white-space: nowrap;
      user-select: none;
      min-width: 0;
      text-align: right;
      padding: 2px 6px;      /* match the vertical breathing room of buttons */
      box-sizing: border-box;
      flex: 0 0 auto;
      overflow: visible;
    }

    /* --- Popup / Window system (classic Mac) --- */
    .popup-overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.55);
      z-index: 3001;
    }

    .popup-window {
      width: min(520px, calc(100vw - 40px));
      max-width: calc(100vw - 40px);
      max-height: calc(100vh - 80px);
      background: #efefef;
      border: 1px solid #000000;
      box-shadow:
        1px 1px 0 #6e6e6e,
        2px 2px 0 #000000;
      display: flex;
      flex-direction: column;
      overflow: hidden; /* keep window inside viewport when screen shrinks */

      /* centered by default, then becomes draggable */
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
    }

    /* Title bar mimics the taskbar aesthetic */
    .popup-titlebar {
      height: 22px;
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 0 6px;
      background: #dfdfdf;
      border-top: 1px solid #ffffff;
      border-bottom: 1px solid #000000;
      box-shadow:
        inset 0 1px 0 #ffffff,
        inset 0 -1px 0 #6e6e6e;
      user-select: none;
      cursor: move; /* drag handle */
      flex: 0 0 auto;
    }

    .popup-title {
      font-size: 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      flex: 1;
    }

    .popup-close {
      width: 14px;
      height: 14px;
      padding: 0;
      background: #dfdfdf;
      border-top: 1px solid #ffffff;
      border-left: 1px solid #ffffff;
      border-right: 1px solid #6f6f6f;
      border-bottom: 1px solid #6f6f6f;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      flex: 0 0 auto;
    }

    .popup-close:active {
      border-top: 1px solid #6f6f6f;
      border-left: 1px solid #6f6f6f;
      border-right: 1px solid #ffffff;
      border-bottom: 1px solid #ffffff;
      background: #dcdcdc;
    }

    .popup-close::before {
      content: "";
      width: 8px;
      height: 8px;
      background: #000;
      /* simple pixel X */
      clip-path: polygon(
        0 10%, 10% 0, 50% 40%, 90% 0, 100% 10%, 60% 50%, 100% 90%, 90% 100%, 50% 60%, 10% 100%, 0 90%, 40% 50%
      );
    }

    .popup-body {
      padding: 10px;
      overflow: auto;
      background: #ffffff;
      border-top: 1px solid #6e6e6e;
      box-shadow: inset 0 1px 0 #ffffff;
      flex: 1 1 auto; /* shrink + scroll on small screens */
      min-height: 0; /* important for flexbox overflow */
    }

    .popup-body img {
      max-width: 100%;
      height: auto;
      display: block;
    }

    /* Flexible popup content blocks */
    .popup-content {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .popup-media {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .popup-media img {
      image-rendering: pixelated;
      max-width: 100%;
      height: auto;
      display: block;
    }

    .popup-text {
      line-height: 1.4;
      white-space: pre-wrap;
    }

    .popup-text.align-left { text-align: left; }
    .popup-text.align-center { text-align: center; }
    .popup-text.align-right { text-align: right; }

    /* Text sizes (feel free to tweak) */
    .popup-text.size-xs { font-size: 9px; }
    .popup-text.size-sm { font-size: 10px; }
    .popup-text.size-md { font-size: 12px; }
    .popup-text.size-lg { font-size: 14px; }
    .popup-text.size-xl { font-size: 16px; }

    /* Footer is caption-only (no buttons) */
    .popup-actions {
      display: flex;
      align-items: center;
      padding: 6px 8px;
      background: #efefef;
      border-top: 1px solid #6e6e6e;
      flex: 0 0 auto;
      justify-content: center; /* center Enter button */
      gap: 8px;
    }

    /* OK / Enter button (classic Mac bevel) */
    .popup-ok {
      -webkit-appearance: none;
      appearance: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      box-sizing: border-box;

      padding: 2px 16px;
      min-height: 22px; /* match titlebar-ish sizing */
      background: #dfdfdf;
      border-top: 1px solid #ffffff;
      border-left: 1px solid #ffffff;
      border-right: 1px solid #6f6f6f;
      border-bottom: 1px solid #6f6f6f;

      cursor: pointer;
      font: inherit;
      font-size: 12px;
      line-height: 1; /* keep pixel font inside */
      white-space: nowrap;
      user-select: none;
    }

    .popup-ok:active {
      border-top: 1px solid #6f6f6f;
      border-left: 1px solid #6f6f6f;
      border-right: 1px solid #ffffff;
      border-bottom: 1px solid #ffffff;
      background: #dcdcdc;
    }

    /* When a popup has an OK button, center it in the footer */
    .popup-window.has-ok .popup-actions {
      justify-content: center;
    }

    .popup-window.has-ok .popup-caption {
      display: none;
    }

    .popup-caption {
      font-size: 10px; /* size-4-ish */
      line-height: 1;
      user-select: none;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .popup-overlay.show {
      display: flex;
    }
  </style>
</head>
<body>
  <div class="desktop" id="desktop">
    <a href="pages/architecture.html" class="icon"><img src="images/folder-160.png" /><span>Architecture</span></a>
    <a href="pages/engineering.html" class="icon"><img src="images/folder-160.png" /><span>Engineering</span></a>
    <a href="pages/graphicdesign.html" class="icon"><img src="images/folder-160.png" /><span>Graphic Design</span></a>
    <a href="pages/aboutme.html" class="icon"><img src="images/folder-160.png" /><span>About Me</span></a>
    <a href="pages/8ball.html" class="icon"><img src="images/folder-160.png" /><span>???</span></a>
  </div>

  <div class="taskbar">
    <div class="left-group">
      <button class="menu-item taskbar-item" type="button" aria-label="About" onclick="openAboutPopup()">
        <img src="images/apple folder.png" alt="Apple Folder" class="menubar-folder" />
        <span class="taskbar-label">About</span>
      </button>

      <a class="menu-item taskbar-item" href="mailto:jam@prtf.io"><span class="taskbar-label">E-mail</span></a>
    </div>

    <div class="right-group">
      <div class="menubar-clock" id="menubarClock"></div>
      <button class="menu-item taskbar-item" type="button" onclick="toggleSearch()" aria-label="Find">
        <img src="images/search icon-64.png" alt="Find" class="menubar-search" />
        <span class="taskbar-label">Find</span>
      </button>
    </div>
  </div>

  <div class="search-bar" id="searchBar">
    <input type="text" placeholder="Find..." onblur="hideSearch()" />
  </div>

  <!-- Global popup container (caption-only footer) -->
  <div class="popup-overlay" id="popupOverlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="popup-window" id="popupWindow">
      <div class="popup-titlebar" id="popupTitlebar">
        <button class="popup-close" type="button" aria-label="Close" onclick="closePopup()"></button>
        <div class="popup-title" id="popupTitle">Welcome</div>
      </div>
      <div class="popup-body" id="popupBody">
        <!-- Fallback content (shows even if JS fails) -->
        <div class="popup-content">
          <div class="popup-text size-xl align-center">WELCOME</div>
          <div class="popup-text size-md align-left">
            This is a long placeholder welcome message intended to test scrolling behavior inside the popup window.

            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non risus. Suspendisse lectus tortor, dignissim sit amet, adipiscing nec, ultricies sed, dolor. Cras elementum ultrices diam. Maecenas ligula massa, varius a, semper congue, euismod non, mi.

            Proin porttitor, orci nec nonummy molestie, enim est eleifend mi, non fermentum diam nisl sit amet erat. Duis semper. Duis arcu massa, scelerisque vitae, consequat in, pretium a, enim. Pellentesque congue.

            Ut in risus volutpat libero pharetra tempor. Cras vestibulum bibendum augue. Praesent egestas leo in pede. Praesent blandit odio eu enim. Pellentesque sed dui ut augue blandit sodales.

            Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Aliquam nibh. Mauris ac mauris sed pede pellentesque fermentum. Maecenas adipiscing ante non diam sodales hendrerit.

            This text continues deliberately to exceed the height of the popup window so that vertical scrolling is required. The popup container itself will never exceed the viewport, but this white content area will scroll independently.

            When you are satisfied with the behavior, replace this entire block with your real introduction copy.
          </div>
        </div>
      </div>
      <div class="popup-actions" id="popupActions">
        <div class="popup-caption" id="popupCaption"></div>
        <button class="popup-ok" id="popupOk" type="button" onclick="closePopup()" style="display:inline-flex;">Enter</button>
      </div>
    </div>
  </div>
  <script>
    (function () {
      'use strict';

      // ---------- Elements ----------
      var popupOverlay = document.getElementById('popupOverlay');
      var popupWindow = document.getElementById('popupWindow');
      var popupTitlebar = document.getElementById('popupTitlebar');
      var popupTitleEl = document.getElementById('popupTitle');
      var popupBodyEl = document.getElementById('popupBody');
      var popupCaptionEl = document.getElementById('popupCaption');
      var popupOkBtn = document.getElementById('popupOk');

      var searchBarEl = document.getElementById('searchBar');
      var clockEl = document.getElementById('menubarClock');

      // ---------- Popup: render flexible content ----------
      function renderPopupContent(content) {
        var wrap = document.createElement('div');
        wrap.className = 'popup-content';

        (content || []).forEach(function (block) {
          if (!block || !block.type) return;

          if (block.type === 'image') {
            var media = document.createElement('div');
            media.className = 'popup-media';

            var img = document.createElement('img');
            img.src = block.src || '';
            img.alt = block.alt || '';
            if (block.maxWidth != null) img.style.maxWidth = String(block.maxWidth) + 'px';
            if (block.width != null) img.style.width = String(block.width) + 'px';

            media.appendChild(img);
            wrap.appendChild(media);
            return;
          }

          if (block.type === 'text') {
            var d = document.createElement('div');
            var size = block.size || 'md';
            var align = block.align || 'left';
            d.className = 'popup-text size-' + size + ' align-' + align;
            d.textContent = block.text || '';
            wrap.appendChild(d);
            return;
          }

          if (block.type === 'html') {
            var h = document.createElement('div');
            h.innerHTML = block.html || '';
            wrap.appendChild(h);
            return;
          }
        });

        return wrap;
      }

      function resetPopupPosition() {
        if (!popupWindow) return;
        popupWindow.style.left = '50%';
        popupWindow.style.top = '50%';
        popupWindow.style.transform = 'translate(-50%, -50%)';
      }

      function openPopup(opts) {
        opts = opts || {};
        if (!popupOverlay) return;

        // Center by default unless preserving
        if (!opts.preservePosition) resetPopupPosition();

        if (popupTitleEl) popupTitleEl.textContent = opts.title || 'Notice';
        if (popupCaptionEl) popupCaptionEl.textContent = opts.caption || '';

        // Body content
        if (popupBodyEl) {
          popupBodyEl.innerHTML = '';
          if (Array.isArray(opts.content)) {
            popupBodyEl.appendChild(renderPopupContent(opts.content));
          } else {
            popupBodyEl.innerHTML = opts.html || '';
          }
        }

        // OK button
        var hasOk = !!opts.okText;
        if (popupOkBtn) {
          if (hasOk) {
            popupOkBtn.textContent = opts.okText;
            popupOkBtn.style.display = 'inline-flex';
          } else {
            popupOkBtn.style.display = 'none';
          }
        }
        if (popupWindow) popupWindow.classList.toggle('has-ok', hasOk);

        popupOverlay.classList.add('show');
        popupOverlay.setAttribute('aria-hidden', 'false');
      }

      function closePopup() {
        if (!popupOverlay) return;
        popupOverlay.classList.remove('show');
        popupOverlay.setAttribute('aria-hidden', 'true');
        resetPopupPosition();
      }

      // Expose for inline onclick hooks
      window.openPopup = openPopup;
      window.closePopup = closePopup;

      window.openAboutPopup = function () {
        openPopup({
          title: 'About',
          caption: 'Jordan A. McKenzie',
          okText: 'Enter',
          content: [
            { type: 'text', text: 'About This Portfolio', size: 'lg', align: 'center' },
            {
              type: 'text',
              size: 'md',
              align: 'left',
              text:
                'This site is a portfolio presented as a classic Macintosh desktop.\n\n' +
                'Click folders to explore projects and work.'
            }
          ]
        });
      };

      // X / Enter / outside click
      (function bindPopupControls() {
        if (!popupOverlay) return;

        var closeBtn = popupOverlay.querySelector('.popup-close');
        if (closeBtn) {
          closeBtn.addEventListener('click', function (e) {
            e.stopPropagation();
            closePopup();
          });
        }

        if (popupOkBtn) {
          popupOkBtn.addEventListener('click', function (e) {
            e.stopPropagation();
            closePopup();
          });
        }

        popupOverlay.addEventListener('mousedown', function (e) {
          if (e.target === popupOverlay) closePopup();
        });
      })();

      // Draggable titlebar
      (function bindPopupDrag() {
        if (!popupTitlebar || !popupWindow) return;

        var dragging = false;
        var offX = 0;
        var offY = 0;

        popupTitlebar.addEventListener('mousedown', function (e) {
          if (e.target && e.target.closest && e.target.closest('.popup-close')) return;
          e.preventDefault();

          var r = popupWindow.getBoundingClientRect();
          popupWindow.style.left = r.left + 'px';
          popupWindow.style.top = r.top + 'px';
          popupWindow.style.transform = 'none';

          dragging = true;
          offX = e.clientX - r.left;
          offY = e.clientY - r.top;
        });

        document.addEventListener('mousemove', function (e) {
          if (!dragging) return;

          var r = popupWindow.getBoundingClientRect();
          var x = e.clientX - offX;
          var y = e.clientY - offY;

          var margin = 10;
          var maxX = window.innerWidth - r.width - margin;
          var maxY = window.innerHeight - r.height - margin;
          x = Math.max(margin, Math.min(maxX, x));
          y = Math.max(margin, Math.min(maxY, y));

          popupWindow.style.left = x + 'px';
          popupWindow.style.top = y + 'px';
        });

        document.addEventListener('mouseup', function () {
          dragging = false;
        });

        window.addEventListener('resize', function () {
          // Keep inside viewport if already dragged (transform removed)
          if (!popupWindow || (popupWindow.style.transform && popupWindow.style.transform !== 'none')) return;
          var r = popupWindow.getBoundingClientRect();
          var margin = 10;
          var x = Math.max(margin, Math.min(window.innerWidth - r.width - margin, r.left));
          var y = Math.max(margin, Math.min(window.innerHeight - r.height - margin, r.top));
          popupWindow.style.left = x + 'px';
          popupWindow.style.top = y + 'px';
        });
      })();

      // ---------- Find dropdown ----------
      window.toggleSearch = function () {
        if (!searchBarEl) return;
        searchBarEl.style.display = (searchBarEl.style.display === 'flex') ? 'none' : 'flex';
        if (searchBarEl.style.display === 'flex') {
          var input = searchBarEl.querySelector('input');
          if (input) input.focus();
        }
      };

      window.hideSearch = function () {
        if (searchBarEl) searchBarEl.style.display = 'none';
      };

      // ---------- Clock ----------
      (function initClock() {
        if (!clockEl) return;
        function tick() {
          var now = new Date();
          var h = now.getHours();
          var m = now.getMinutes();
          var ampm = h >= 12 ? 'PM' : 'AM';
          h = h % 12;
          if (h === 0) h = 12;
          var mm = (m < 10 ? '0' + m : '' + m);
          var colon = (now.getSeconds() % 2 === 0) ? ':' : ' ';
          clockEl.textContent = '' + h + colon + mm + ' ' + ampm;
        }
        tick();
        setInterval(tick, 1000);
      })();

      // ---------- Desktop icons (layout + drag) ----------
      var icons = Array.prototype.slice.call(document.querySelectorAll('.icon'));

      function layoutIcons() {
        var paddingLeft = 10;
        var paddingTop = 10;
        var gapX = 12;
        var gapY = 30;
        var iconW = 99;
        var iconH = 120;

        var x = paddingLeft;
        var y = paddingTop;

        icons.forEach(function (icon) {
          if (x + iconW > window.innerWidth - 10) {
            x = paddingLeft;
            y += iconH + gapY;
          }
          icon.style.left = x + 'px';
          icon.style.top = y + 'px';
          x += iconW + gapX;
        });
      }

      var draggingIcon = false;
      var possibleDrag = false;
      var startX = 0;
      var startY = 0;
      var offX2 = 0;
      var offY2 = 0;
      var activeIcon = null;
      var threshold = 5;

      function clearSelections() {
        icons.forEach(function (i) { i.classList.remove('selected'); });
      }

      icons.forEach(function (icon) {
        icon.addEventListener('mousedown', function (e) {
          e.preventDefault();
          startX = e.clientX;
          startY = e.clientY;
          activeIcon = icon;
          offX2 = e.clientX - icon.offsetLeft;
          offY2 = e.clientY - icon.offsetTop;
          possibleDrag = true;
          draggingIcon = false;
          clearSelections();
          icon.classList.add('selected');
        });

        icon.addEventListener('dblclick', function (e) {
          // navigate
          e.preventDefault();
          window.location.href = icon.href;
        });

        icon.addEventListener('click', function (e) {
          // select only
          e.preventDefault();
          clearSelections();
          icon.classList.add('selected');
        });
      });

      document.addEventListener('mousemove', function (e) {
        if (!possibleDrag || !activeIcon) return;

        if (!draggingIcon) {
          var dx = e.clientX - startX;
          var dy = e.clientY - startY;
          if (Math.abs(dx) > threshold || Math.abs(dy) > threshold) {
            draggingIcon = true;
            activeIcon.style.zIndex = 1000;
          }
        }

        if (draggingIcon) {
          var x = e.clientX - offX2;
          var y = e.clientY - offY2;
          x = Math.max(0, Math.min(window.innerWidth - activeIcon.offsetWidth, x));
          y = Math.max(0, Math.min(window.innerHeight - activeIcon.offsetHeight, y));
          activeIcon.style.left = x + 'px';
          activeIcon.style.top = y + 'px';
        }
      });

      document.addEventListener('mouseup', function () {
        possibleDrag = false;
        draggingIcon = false;
        if (activeIcon) activeIcon.style.zIndex = '';
        activeIcon = null;
      });

      document.addEventListener('click', function (e) {
        if (!e.target.closest('.icon')) clearSelections();
      });

      window.addEventListener('resize', function () {
        // If not actively dragging an icon, reflow
        if (!draggingIcon) layoutIcons();
      });

      // Initial layout
      layoutIcons();
      window.addEventListener('load', function () {
        layoutIcons();
        requestAnimationFrame(layoutIcons);
      });

      // ---------- Welcome popup on page load ----------
      function showWelcomePopup() {
        openPopup({
          title: 'Welcome',
          caption: '',
          okText: 'Enter',
          content: [
            { type: 'text', text: 'WELCOME', size: 'xl', align: 'center' },
            {
              type: 'text',
              size: 'md',
              align: 'left',
              text:
                'This is a long placeholder welcome message intended to test scrolling behavior inside the popup window.\n\n' +
                'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non risus. Suspendisse lectus tortor, dignissim sit amet, adipiscing nec, ultricies sed, dolor. Cras elementum ultrices diam. Maecenas ligula massa, varius a, semper congue, euismod non, mi.\n\n' +
                'Proin porttitor, orci nec nonummy molestie, enim est eleifend mi, non fermentum diam nisl sit amet erat. Duis semper. Duis arcu massa, scelerisque vitae, consequat in, pretium a, enim. Pellentesque congue.\n\n' +
                'Ut in risus volutpat libero pharetra tempor. Cras vestibulum bibendum augue. Praesent egestas leo in pede. Praesent blandit odio eu enim. Pellentesque sed dui ut augue blandit sodales.\n\n' +
                'Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Aliquam nibh. Mauris ac mauris sed pede pellentesque fermentum. Maecenas adipiscing ante non diam sodales hendrerit.\n\n' +
                'This text continues deliberately to exceed the height of the popup window so that vertical scrolling is required. The popup container itself will never exceed the viewport, but this white content area will scroll independently.\n\n' +
                'When you are satisfied with the behavior, replace this entire block with your real introduction copy.'
            }
          ]
        });
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', showWelcomePopup);
      } else {
        showWelcomePopup();
      }

    })();
  </script>
</body>
</body>
</html>
